var runScripts;CoffeeScript.loadFile=function(file){var code;return alert(file),code=php.file_get_contents(file),eval(CoffeeScript.compile(code))},CoffeeScript.eval=function(code,options){return eval(CoffeeScript.compile(code,options))},CoffeeScript.run=function(e,t){return null==t&&(t={}),t.bare=!0,window.eval.call(window,CoffeeScript.compile(e,t))},CoffeeScript.load=function(e,t){var n;return n=new(window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP"),n.open("GET",e,!0),"overrideMimeType"in n&&n.overrideMimeType("text/plain"),n.onreadystatechange=function(){var r;if(4===n.readyState){if(0!==(r=n.status)&&200!==r)throw new Error("Could not load "+e);if(CoffeeScript.run(n.responseText),t)return t()}},n.send(null)},runScripts=function(){var e,t,n,r,o,i;return i=document.getElementsByTagName("script"),e=function(){var e,t,n;for(n=[],e=0,t=i.length;t>e;e++)o=i[e],"text/coffeescript"===o.type&&n.push(o);return n}(),n=0,r=e.length,(t=function(){var r;return r=e[n++],"text/coffeescript"===(null!=r?r.type:void 0)?r.src?CoffeeScript.load(r.src,t):(CoffeeScript.run(r.innerHTML),t()):void 0})(),null},window.addEventListener?addEventListener("DOMContentLoaded",runScripts,!1):attachEvent("onload",runScripts);
var CanvasBox;Load.CanvasBoxException(),CanvasBox=function(){function t(e,o,n){var i,r;if(null==o&&(o=400),null==n&&(n=400),console.log("canvasbox constructor "+e),this.defaultWidth=o,this.defaultHeight=n,this.width=this.defaultWidth/this.dblZoom,this.height=this.defaultHeight/this.dblZoom,this.id=t.prototype.arrInstances.length,t.prototype.arrInstances[this.id]=this,this.objCanvasHtml=document.getElementById(e),null===this.objCanvasHtml)throw New.CanvasBoxException("Invalid canvas html element id ["+e+"]");return this.getPosition(),r=""+this.defaultWidth+"px",this.objCanvasHtml.setAttribute("width",r),i=""+this.defaultHeight+"px",this.objCanvasHtml.setAttribute("height",i),this.objCanvasHtml.setAttribute("contentEditable","true"),this.objCanvasHtml.contentEditable=!0,this.objCanvasHtml.addEventListener("mousemove",function(t){return function(e){return t.onMouseMove(e)}}(this)),this.objCanvasHtml.addEventListener("click",function(t){return function(e){return t.onClick(e)}}(this)),this.objCanvasHtml.addEventListener("dblclick",function(t){return function(e){return t.onDblClick(e)}}(this)),this.objCanvasHtml.addEventListener("mouseup",function(t){return function(e){return t.onMouseUp(e)}}(this)),this.objCanvasHtml.addEventListener("mousedown",function(t){return function(e){return t.onMouseDown(e)}}(this)),this.objCanvasHtml.addEventListener("contextmenu",function(t){return function(e){return t.onContextMenu(e)}}(this)),this.objCanvasHtml.addEventListener("keyup",function(t){return function(e){return t.onKeyUp(e)}}(this)),this.objCanvasHtml.addEventListener("mouseout",function(t){return function(e){return t.onMouseOut(e)}}(this)),this.objCanvasHtml.addEventListener("mouseover",function(t){return function(e){return t.onMouseOver(e)}}(this)),this.defineMenu(),this.play(),this.init(),this}return t.prototype.dblZoom=1,t.prototype.intCounterStandyBy=0,t.prototype.x=0,t.prototype.y=0,t.prototype.id=null,t.prototype.width=400,t.prototype.height=400,t.prototype.defaultWidth=400,t.prototype.defaultHeight=400,t.prototype.objCanvasHtml=null,t.prototype.arrElements=Array(),t.prototype.arrButtons=Array(),t.prototype.objElementOver=null,t.prototype.objElementClicked=null,t.prototype.intIntervalDraw=0,t.prototype.intIntervalTimer=1,t.prototype.booActive=!1,t.prototype.mouseX=0,t.prototype.mouseY=0,t.prototype.booOnDraw=!1,t.prototype.booOnTimer=!1,t.prototype.booChanged=!0,t.prototype.booMouseOver=!0,t.prototype.booDrawBoxMenu=!0,t.prototype.intRightButtonClick=2,t.prototype.strClassName="CanvasBox",t.prototype.intFps=0,t.prototype.intLastFps=0,t.prototype.booCountFps=!1,t.prototype.backgroundColor="white",t.prototype.booShowMenu=!1,t.prototype.objMenu=null,t.prototype.objMenuSelected=null,t.prototype.intTimeoutTimer=null,t.prototype.intTimeoutDraw=null,t.prototype.intTimeoutFPS=null,t.prototype.clientWidth=function(){return t.prototype.filterResults(null!=window.innerWidth?window.innerWidth:window.innerWidth=0,null!=document.documentElement?document.documentElement:document.documentElement=0,null!=document.body?document.body:document.body=0)},t.prototype.toSerialize=function(){var t;return t=new Object,t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t.objCanvasHtml=this.objCanvasHtml,t.intIntervalDraw=this.intIntervalDraw,t.booActive=this.booActive,t.booOnDraw=this.booOnDraw,t.arrElements=this.arrElements,t},t.prototype.defineMenu=function(){return this.objMenu=New.CanvasBoxMenu(),this.objMenu.objParent=this,this.objMenu.objBox=this,this.objMenu.arrMenuItens={0:{name:"create class",event:function(t){var e;return e=New.CanvasBoxClass(),e.objBehavior=New.CanvasBoxMagneticBehavior(e),e.x=t.mouseX,e.y=t.mouseY,t.addElement(e)}},1:{name:"create square",event:function(t){var e;return e=New.CanvasBoxSquare(),e.objBehavior=New.CanvasBoxMagneticBehavior(e),e.x=t.mouseX,e.y=t.mouseY,t.addElement(e)}}},this.objMenuSelected=null,this},t.prototype.getPosition=function(){var t,e,o;for(e=this.objCanvasHtml.offsetLeft,o=this.objCanvasHtml.offsetTop,t=this.objCanvasHtml;t.offsetParent&&t!==document.getElementsByTagName("body")[0];)e+=t.offsetParent.offsetLeft,o+=t.offsetParent.offsetTop,t=t.offsetParent;return this.x=e,this.y=o,this},t.prototype.setBackgroundColor=function(t){return this.backgroundColor=t,this.objCanvasHtml.style.backgroundColor=this.backgroundColor,this},t.prototype.init=function(){},t.prototype.addElement=function(t){return this.arrElements.push(t),t.objBox=this,t.objContext=this.getContext(),t.load()},t.prototype.getContext=function(){var t;return t=this.objCanvasHtml.getContext("2d")},t.prototype.clear=function(){var t;return t=this.getContext(),t.clearRect(0,0,Math.max(this.width,this.defaultWidth),Math.max(this.height,this.defaultHeight)),this.defaultStyle()},t.prototype.draw=function(){var t,e,o,n,i,r,s,h,u,l,a,d,c,p;if(!this.booChanged)return void this.intCounterStandyBy++;for(this.intCounterStandyBy=0,this.booOnDraw=!0,this.clear(),e=Array(),c=this.arrElements,i=0,u=c.length;u>i;i++)n=c[i],null==e[n.z]&&(e[n.z]=Array()),e[n.z].push(n);for(e=php.sort(e),r=0,l=e.length;l>r;r++)for(t=e[r],s=0,a=t.length;a>s;s++)n=t[s],null!=n&&n.onDraw();if(n=null,this.booShowMenu&&(this.objMenuSelected.mouseX=this.mouseX,this.objMenuSelected.mouseY=this.mouseY,this.objMenuSelected.onDraw()),this.booDrawBoxMenu)for(p=this.arrButtons,h=0,d=p.length;d>h;h++)o=p[h],o.refresh(),o.onDraw();return this.booOnDraw=!1,this.booChanged=!1},t.prototype.onTimerElements=function(){var t,e,o,n;for(this.booOnTimer=!0,n=this.arrElements,e=0,o=n.length;o>e;e++)t=n[e],php.is_object(t)&&t.onTimer();return this.booOnTimer=!1},t.prototype.play=function(){return this.intCounterStandyBy=0,this.booActive?void 0:(this.booActive=!0,this.intTimeoutTimer=setTimeout(this.onTimer.bind(this),this.intIntervalTimer),this.intTimeoutDraw=setTimeout(this.onDraw.bind(this),this.intIntervalDraw),this.intTimeoutFPS=setTimeout(this.onCountFps.bind(this),1e3))},t.prototype.stop=function(){return this.booActive=!1,window.clearTimeout(this.intTimeoutTimer),window.clearTimeout(this.intTimeoutDraw),window.clearTimeout(this.intTimeoutFPS)},t.prototype.onTimer=function(){return this.booActive===!1?!1:(this.intCounterStandyBy<10?this.intTimeoutTimer=setTimeout(this.onTimer.bind(this),this.intIntervalTimer):this.booMouseOver?this.intTimeoutTimer=setTimeout(this.onTimer.bind(this),2*this.intIntervalTimer):(this.intCounterStandyBy=0,this.stop()),this.intCounterStandyBy>10&&(this.intCounterStandyBy=10),this.booOnTimer||this.onTimerElements(),!0)},t.prototype.onCountFps=function(){return this.intLastFps=this.intFps,this.intFps=0,this.booCountFps?(document.title="FPS: "+this.intLastFps,this.intTimeoutFPS=setTimeout(this.onCountFps.bind(this),1e3),!0):!1},t.prototype.onDraw=function(){return this.booActive===!1?!1:(this.intTimeoutDraw=setTimeout(this.onDraw.bind(this),this.intIntervalDraw),this.booOnDraw||(this.draw(),this.intFps++),!0)},t.prototype.refreshMousePosition=function(e){return null==e&&(e=null),null!=e?(this.mouseX=(e.clientX-this.x+t.prototype.scrollLeft())/this.dblZoom,this.mouseY=(e.clientY-this.y+t.prototype.scrollTop())/this.dblZoom):void 0},t.prototype.onMouseMove=function(t){var e,o,n,i,r,s,h,u,l,a;for(null==t&&(t=null),n=null,this.refreshMousePosition(t),u=this.arrElements,i=0,s=u.length;s>i;i++)if(o=u[i],php.is_object(o)&&o.isInside(this.mouseX,this.mouseY)){this.change(),n=o;break}for(this.objElementOver!==n&&(this.change(),null!==this.objElementOver&&this.objElementOver.onMouseOut(t),null!==n&&(this.booMouseOver=!0,n.onMouseOver(t))),this.objCanvasHtml.style.cursor=null!==n?"pointer":"default",this.objElementOver=n,null!=this.objElementSelected&&(this.change(),this.objElementSelected.onDrag(t)),l=this.arrButtons,a=[],r=0,h=l.length;h>r;r++)e=l[r],e.refresh(),a.push(e.booMouseOver!==e.isInside(this.mouseX*this.dblZoom,this.mouseY*this.dblZoom)?this.change():void 0);return a},t.prototype.onMouseUp=function(t){return this.booMouseOver=!0,null!=this.objElementSelected&&(this.change(),this.objElementSelected.onDrop(t)),this.objElementSelected=null},t.prototype.onMouseDown=function(t){return this.booMouseOver=!0,this.change(),this.objElementSelected=this.objElementOver,null!=this.objElementSelected&&this.objElementSelected.onMouseDown(t),!1},t.prototype.onClick=function(t){var e,o,n,i;if(this.objCanvasHtml.focus(),this.booMouseOver=!0,this.change(),this.booShowMenu)return this.booShowMenu=this.objMenuSelected.onClick(t),!1;for(null!==this.objElementOver?(this.objElementClicked=this.objElementOver,this.objElementOver.onClick(t)):(this.objElementClicked=null,this.onBoxClick(t)),i=this.arrButtons,o=0,n=i.length;n>o;o++)e=i[o],e.refresh(),e.booMouseOver&&e.onClick();return!1},t.prototype.onDblClick=function(t){return this.booMouseOver=!0,this.change(),null!==this.objElementOver?this.objElementOver.onDblClick(t):this.onBoxDblClick(t)},t.prototype.onBoxRightClick=function(){return this.booMouseOver=!0,this.change(),!1},t.prototype.onContextMenu=function(t){return this.booMouseOver=!0,this.change(),null!==this.objElementOver?this.objElementOver.onContextMenu(t):this.onBoxContextMenu(t),!1},t.prototype.onBoxContextMenu=function(){return this.booMouseOver=!0,this.change(),this.booShowMenu=!this.booShowMenu,this.booShowMenu?(this.objMenu.objBox=this,this.objMenuSelected=this.objMenu,this.objMenuSelected.intMenuX=this.mouseX,this.objMenuSelected.intMenuY=this.mouseY,this.objMenuSelected.strActualMenuItem=null):void 0},t.prototype.onBoxClick=function(t){return this.booMouseOver=!0,this.change(),this.booShowMenu?this.booShowMenu=this.objMenuSelected.onClick(t):void 0},t.prototype.onBoxDblClick=function(){return this.booMouseOver=!0,this.change()},t.prototype.onKeyUp=function(t){switch(this.change(),t.keyCode){case 46:null!==this.objElementClicked&&this.deleteElement(this.objElementClicked);break;case 38:null!==this.objElementClicked&&this.objElementClicked.goUp();break;case 40:null!==this.objElementClicked&&this.objElementClicked.goDown();break;case 39:null!==this.objElementClicked&&this.objElementClicked.goRight();break;case 37:null!==this.objElementClicked&&this.objElementClicked.goLeft();break;case 32:null!==this.objElementClicked&&(this.objElementClicked.fixed=!this.objElementClicked.fixed,this.objElementClicked.drawFixed(this.objElementClicked.fixed));break;case 113:null!==this.objElementClicked&&this.objElementClicked.rename();break;case 45:null!==this.objElementClicked&&this.objElementClicked.copy()}return!1},t.prototype.deleteElement=function(t,e){var o;return null==e&&(e=!0),this.change(),e&&t.onDelete(),o=this.arrElements.indexOf(t),console.log(" index of intId "),-1!==o&&this.arrElements.splice(o,1),this.objElementClicked=this.arrElements.length>0?null:null},t.prototype.onMouseOver=function(){return this.booMouseOver=!0,this.play()},t.prototype.onMouseOut=function(){return this.booMouseOver=!1},t.prototype.change=function(){return this.play(),this.intCounterStandyBy=0,this.booChanged=!0},t.prototype.moveTo=function(t,e){return this.getContext().moveTo(Math.round(t*this.dblZoom),Math.round(e*this.dblZoom))},t.prototype.lineTo=function(t,e){return this.getContext().lineTo(Math.round(t*this.dblZoom)+.5,Math.round(e*this.dblZoom)+.5)},t.prototype.quadraticCurveTo=function(t,e,o,n){return this.getContext().quadraticCurveTo(Math.round(t*this.dblZoom),Math.round(e*this.dblZoom),Math.round(o*this.dblZoom)+.5,Math.round(n*this.dblZoom)+.5)},t.prototype.bezierCurveTo=function(t,e,o,n){return this.getContext().bezierCurveTo(Math.round(t*this.dblZoom),Math.round(e*this.dblZoom),Math.round(t*this.dblZoom),Math.round(e*this.dblZoom),Math.round(o*this.dblZoom),Math.round(n*this.dblZoom))},t.prototype.arc=function(t,e,o,n,i,r){return this.getContext().arc(Math.round(t*this.dblZoom),Math.round(e*this.dblZoom),Math.abs(Math.round(o*this.dblZoom)),n,i,r)},t.prototype.defaultStyle=function(){return this.setFillStyle("red"),this.setStrokeStyle("red"),this.setLineWidth("1px")},t.prototype.saveContext=function(){return this.getContext().save(),this.defaultStyle()},t.prototype.restoreContext=function(){return this.getContext().restore(),this.defaultStyle()},t.prototype.beginPath=function(){return this.getContext().beginPath()},t.prototype.closePath=function(){return this.getContext().closePath()},t.prototype.setFillStyle=function(t){var e;try{return null==t&&(e=function(){throw new CanvasBoxException("Fill Style not defined")}()),this.getContext().fillStyle=t}catch(o){throw e=o,new CanvasBoxException("Error on set Fill Style ["+t+"]")}},t.prototype.setStrokeStyle=function(t){var e;try{if(null==t)throw e=new CanvasBoxException("Stroke Style not defined");return this.getContext().strokeStyle=t}catch(o){throw e=o,new CanvasBoxException("Error on set Stroke Style ["+t+"]")}},t.prototype.setLineWidth=function(t){var e;try{return this.getContext().lineWidth=t*this.dblZoom}catch(o){throw e=o,new CanvasBoxException("Error on set Line Width ["+t+"]")}},t.prototype.fill=function(){return this.getContext().fill()},t.prototype.stroke=function(){return this.getContext().stroke()},t.prototype.strokeText=function(t,e,o){var n;try{return this.getContext().strokeText(t,Math.round(e*this.dblZoom),Math.round(o*this.dblZoom))}catch(i){throw n=i,new CanvasBoxException("Error on set Stroke Text")}},t.prototype.fillText=function(t,e,o){var n;try{return this.getContext().fillText(t,Math.round(e*this.dblZoom)+.5,Math.round(o*this.dblZoom)+.5)}catch(i){throw n=i,new CanvasBoxException("Error on fill Text")}},t.prototype.strokeRect=function(t,e,o,n){var i;try{return this.getContext().strokeRect(Math.round(t*this.dblZoom)+.5,Math.round(e*this.dblZoom)+.5,Math.round(o*this.dblZoom)+.5,Math.round(n*this.dblZoom)+.5)}catch(r){throw i=r,new CanvasBoxException("Error on stroke Rect")}},t.prototype.fillRect=function(t,e,o,n){var i;try{return this.getContext().fillRect(Math.round(t*this.dblZoom)+.5,Math.round(e*this.dblZoom)+.5,Math.round(o*this.dblZoom)+.5,Math.round(n*this.dblZoom)+.5)}catch(r){throw i=r,new CanvasBoxException("Error on fill Rect")}},t.prototype.setShadowOffsetX=function(t){var e;try{return this.getContext().shadowOffsetX=Math.round(t*this.dblZoom)}catch(o){throw e=o,new CanvasBoxException("Error on set Shadow Offset X")}},t.prototype.setShadowOffsetY=function(t){var e;try{return this.getContext().shadowOffsetY=Math.round(t*this.dblZoom)}catch(o){throw e=o,new CanvasBoxException("Error on set Shadow Offset Y")}},t.prototype.setShadowBlur=function(t){var e;try{return this.getContext().shadowBlur=t}catch(o){throw e=o,new CanvasBoxException("Error on set Shadow Blur")}},t.prototype.setShadowColor=function(t){var e;try{return this.getContext().shadowColor=t}catch(o){throw e=o,new CanvasBoxException("Error on set Shadow Color")}},t.prototype.setFont=function(t){var e,o,n,i,r,s,h,u,l,a;try{for(e=php.explode(" ",t),n=l=0,a=e.length;a>l;n=++l)r=e[n],(r.indexOf("px")>-1||r.indexOf("pt")>-1)&&(h=r.substr(0,r.length-2),u=r.substr(r.length-2),o=1*h,o*=this.dblZoom,s=o+u,e[n]=s);return t=php.implode(" ",e),this.getContext().font=t}catch(d){throw i=d,new CanvasBoxException("Error on set Font "+t)}},t.prototype.translate=function(t,e){var o;try{return this.getContext().translate(t,e)}catch(n){throw o=n,new CanvasBoxException("Error on translate")}},t.prototype.drawLine=function(t,e,o,n){var i,r;try{return this.getContext().moveTo(t+.5,e+.5),this.getContext().lineTo(o+.5,n+.5)}catch(s){throw r=s,i=new CanvasBoxException("Error on drawLine"),i.setParentError(r),i}},t.prototype.drawQuadraticLine=function(t,e,o,n,i,r){var s,h;try{return this.getContext().moveTo(t+.5,e+.5),this.getContext().quadraticCurveTo(i,r,o+.5,n+.5)}catch(u){throw h=u,s=new CanvasBoxException("Error on quadraticCurveTo"),s.setParentError(h),s}},t.prototype.drawBezierLine=function(t,e,o,n,i,r){var s,h;try{return this.getContext().moveTo(t+.5,e+.5),this.bezierCurveTo(i,r,o+.5,n+.5)}catch(u){throw h=u,s=new CanvasBoxException("Error on drawBezierLine"),s.setParentError(h),s}},t.prototype.rotate=function(t){var e;try{return this.getContext().rotate(t)}catch(o){throw e=o,new CanvasBoxException("Error on rotate")}},t.prototype.setTextAlign=function(t){var e;try{return this.getContext().textAlign=t}catch(o){throw e=o,new CanvasBoxException("Error on setTextAling "+t)}},t.prototype.addButton=function(t){return t.intPaddingLeft=0,t.intPaddingTop=0,this.arrButtons.length>0?(t.strPositionHorizontal="right",t.strPositionVertical="middle",t.objPreviousButton=this.arrButtons[this.arrButtons.length-1]):(t.strPositionHorizontal="left",t.strPositionVertical="top"),this.arrButtons.push(t)},t.prototype.saveFile=function(){var t,e,o,n,i,r,s,h,u,l,a;return o=this.defaultHeight/this.defaultWidth,i=1e3,n=Math.round(i/o),e=this.dblZoom,t=i/this.defaultWidth,this.objCanvasHtml.setAttribute("width",i+"px"),this.objCanvasHtml.setAttribute("height",n+"px"),this.dblZoom=t,h=document.createElement("form"),u=document.createElement("textarea"),s=document.createElement("input"),r=document.createElement("input"),this.onMouseOut(null),this.booDrawBoxMenu=!1,this.stop(),this.draw(),l=this.objCanvasHtml.toDataURL("image/png"),a=window.MAIN_PATH,h.setAttribute("action",a+"/download.php"),h.setAttribute("method","post"),h.setAttribute("target","saveWindow"),u.setAttribute("name","base64Content"),u.value=l,s.setAttribute("type","text"),s.setAttribute("name","fileName"),s.value="diagram.png",r.setAttribute("type","text"),r.setAttribute("name","imageType"),r.value="image/png",h.appendChild(u),h.appendChild(s),h.appendChild(r),document.body.appendChild(h),h.submit(),this.play(),this.booDrawBoxMenu=!0,window.setTimeout(function(){return window.open("../default/close.html","saveWindow")},3e4),document.body.removeChild(h),this.dblZoom=e,this.objCanvasHtml.setAttribute("width",this.defaultWidth+"px"),this.objCanvasHtml.setAttribute("height",this.defaultHeight+"px")},t.prototype.saveAsXml=function(){return alert("Feature in development. Try it tomorrow!")},t}(),CanvasBox.prototype.arrInstances=Array(),CanvasBox.prototype.getCanvasBoxById=function(t){return CanvasBox.prototype.arrInstances[t]},CanvasBox.prototype.clientHeight=function(){return CanvasBox.prototype.filterResults(null!=window.innerHeight?window.innerHeight:window.innerHeight=0,null!=document.documentElement?document.documentElement:document.documentElement=0,null!=document.body?document.body:document.body=0)},CanvasBox.prototype.scrollLeft=function(){var t,e;return CanvasBox.prototype.filterResults(null!=window.pageXOffset?window.pageXOffset:window.pageXOffset=0,null!=(t=document.documentElement).scrollWidth?t.scrollWidth:t.scrollWidth=0,null!=(e=document.body).scrollWidth?e.scrollWidth:e.scrollWidth=0)},CanvasBox.prototype.scrollTop=function(){var t,e;return CanvasBox.prototype.filterResults(null!=window.pageYOffset?window.pageYOffset:window.pageYOffset=0,null!=(t=document.documentElement).scrollHeight?t.scrollHeight:t.scrollHeight=0,null!=(e=document.body).scrollHeight?e.scrollHeight:e.scrollHeight=0)},CanvasBox.prototype.filterResults=function(t,e,o){return t};
var CanvasBoxBehavior;CanvasBoxBehavior=function(){function o(o){null!=o&&(this.objBoxElement=o,this.objBoxElement.dx=0,this.objBoxElement.dy=0)}return o.prototype.objBoxElement=null,o.prototype.intMargin=20,o.prototype.strClassName="CanvasBoxBehavior",o.prototype.toSerialize=function(){return{}},o.prototype.getBox=function(){return this.objBoxElement.objBox},o.prototype.onMouseOver=function(){return!1},o.prototype.onMouseOut=function(){return!1},o.prototype.onMouseDown=function(){return this.objBoxElement.relativeMousex=this.objBoxElement.x-this.objBoxElement.objBox.mouseX,this.objBoxElement.relativeMousey=this.objBoxElement.y-this.objBoxElement.objBox.mouseY,!1},o.prototype.onClick=function(){return!1},o.prototype.onDblClick=function(){return this.objBoxElement.setFixed(!this.objBoxElement.fixed),this.objBoxElement.draw()},o.prototype.onDrag=function(){return this.dragdrop=!0,this.objBoxElement.x=this.objBoxElement.objBox.mouseX+this.objBoxElement.relativeMousex,this.objBoxElement.y=this.objBoxElement.objBox.mouseY+this.objBoxElement.relativeMousey,this.objBoxElement.drawDrag&&this.objBoxElement.drawDrag(),!1},o.prototype.onDrop=function(){return this.dragdrop=!1,this.objBoxElement.drawDrop?this.objBoxElement.drawDrop():void 0},o.prototype.onTimer=function(){return this.move()},o.prototype.getForce=function(){var o;return o=Array()},o.prototype.move=function(){return!0},o.prototype.changeBehavior=function(o){var t;return t=New[o](this.objBoxElement),t.objBoxElement=this.objBoxElement,t.dx=this.dx,t.dy=this.dy,this.objBoxElement.objBehavior=t,t},o}();
var CanvasBoxButton;CanvasBoxButton=function(){function t(){}return t.prototype.strTitle="Default Button",t.prototype.intPaddingTop=0,t.prototype.intPaddingLeft=0,t.prototype.intRelativeX=0,t.prototype.intRelativeY=0,t.prototype.x=0,t.prototype.y=0,t.prototype.arrPositionsHorizontal=["left","center","right"],t.prototype.strPositionHorizontal="right",t.prototype.arrPositionsVertical=["top","middle","bottom"],t.prototype.strPositionVertical="top",t.prototype.width=25,t.prototype.height=25,t.prototype.borderWidth=10,t.prototype.borderHeight=3,t.prototype.objPreviousButton=null,t.prototype.objElement=null,t.prototype.booMouseOver=!1,t.prototype.initialize=function(t){return this.objElement=t},t.prototype.refresh=function(){if(null===this.objPreviousButton){switch(this.strPositionHorizontal){case"left":this.intRelativeX=-this.width(-this.borderWidth);break;case"center":this.intRelativeX=this.objElement.width/2;break;case"right":this.intRelativeX=this.objElement.width+this.borderWidth;break;default:throw Error("invalid horizontal position "+this.strPositionHorizontal)}switch(this.strPositionVertical){case"top":this.intRelativeY=-this.height(-this.borderHeight);break;case"middle":this.intRelativeY=this.objElement.height/2;break;case"bottom":this.intRelativeY=this.objElement.height+this.borderHeight;break;default:throw Error("invalid vertical position "+this.strPositionVertical)}}else{switch(this.strPositionHorizontal){case"left":this.intRelativeX="middle"===this.strPositionVertical?this.objPreviousButton.intRelativeX:this.objPreviousButton.intRelativeX+this.objPreviousButton.width+this.objPreviousButton.borderWidth;break;case"center":this.intRelativeX=this.objElement.width/2;break;case"right":this.intRelativeX="middle"===this.strPositionVertical?this.objPreviousButton.intRelativeX:this.objPreviousButton.intRelativeX-this.width-this.borderWidth;break;default:throw Error("invalid horizontal position "+this.strPositionHorizontal)}switch(this.strPositionVertical){case"top":this.intRelativeY="center"===this.strPositionHorizontal?this.objPreviousButton.intRelativeY-this.height-this.borderHeight:-this.height-this.borderHeight;break;case"middle":this.intRelativeY=this.objPreviousButton.intRelativeY+this.height+this.borderHeight;break;case"bottom":this.intRelativeY="center"===this.strPositionHorizontal?this.objPreviousButton.intRelativeY+this.objPreviousButton.height+this.objPreviousButton.borderHeight:this.objElement.height+this.borderHeight;break;default:throw Error("invalid vertical position "+this.strPositionVertical)}}return this.x=this.objElement.x-this.objElement.width/2+this.intRelativeX+this.intPaddingLeft,this.y=this.objElement.y-this.objElement.height/2+this.intRelativeY+this.intPaddingTop},t.prototype.drawOut=function(){return this.objElement.objBox.setFillStyle("rgb( 250 , 250 , 250 )"),this.objElement.objBox.fillRect(Math.round(this.x),Math.round(this.y),Math.round(this.width),Math.round(this.height)),this.objElement.objBox.setStrokeStyle("rgb( 100 , 100 , 100 )"),this.objElement.objBox.setLineWidth(1),this.objElement.objBox.strokeRect(Math.round(this.x),Math.round(this.y),Math.round(this.width),Math.round(this.height))},t.prototype.drawOver=function(){return this.objElement.objBox.setFillStyle("rgb( 230 , 230 , 250 )"),this.objElement.objBox.fillRect(Math.round(this.x),Math.round(this.y),Math.round(this.width),Math.round(this.height)),this.objElement.objBox.setStrokeStyle("blue"),this.objElement.objBox.setLineWidth(1),this.objElement.objBox.strokeRect(Math.round(this.x),Math.round(this.y),Math.round(this.width),Math.round(this.height))},t.prototype.drawIcon=function(){var t;return this.objElement.objBox.beginPath(),this.objElement.objBox.saveContext(),this.objElement.objBox.setStrokeStyle("rgb( 20, 20, 20)"),this.objElement.objBox.setFfillStyle(null!=(t=this.booMouseOver)?t:{"rgb( 250, 250, 250)":"rgb( 220, 220, 220)"}),this.objElement.objBox.moveTo(this.x,this.y+this.height),this.objElement.objBox.lineTo(this.x+6,this.y+this.height-2),this.objElement.objBox.lineTo(this.x+8,this.y+this.height-8),this.objElement.objBox.lineTo(this.x+16,this.y+this.height-16),this.objElement.objBox.lineTo(this.x+30,this.y+this.height-16),this.objElement.objBox.lineTo(this.x+30,this.y+this.height-30),this.objElement.objBox.lineTo(this.x+16,this.y+this.height-30),this.objElement.objBox.lineTo(this.x+16,this.y+this.height-16),this.objElement.objBox.lineTo(this.x+8,this.y+this.height-8),this.objElement.objBox.lineTo(this.x+2,this.y+this.height-6),this.objElement.objBox.lineTo(this.x,this.y+this.height),this.objElement.objBox.stroke(),this.objElement.objBox.fill(),this.objElement.objBox.restoreContext(),this.objElement.objBox.closePath()},t.prototype.drawTitle=function(){return this.objElement.objBox.saveContext(),this.objElement.objBox.setShadowOffsetX(2),this.objElement.objBox.setShadowOffsetY(2),this.objElement.objBox.setShadowBlur(2),this.objElement.objBox.setShadowColor("rgba(0, 0, 0, 0.5)"),this.objElement.objBox.setFont("20px Times New Roman"),this.objElement.objBox.setFillStyle("rgb( 100 , 100, 100 )"),this.objElement.objBox.fillText(this.strTitle,this.x,this.y-20),this.objElement.objBox.restoreContext()},t.prototype.drawButton=function(){return this.booMouseOver?this.drawOver():this.drawOut(),this.drawIcon()},t.prototype.draw=function(){return this.refresh(),this.objElement.booMouseOver&&(this.drawButton(),this.booMouseOver)?this.drawTitle():void 0},t.prototype.onClick=function(){return CanvasBoxClass.Static.createRelation(this.objElement,!0,"CanvasBoxAggregation")},t.prototype.onDrag=function(){var t;return t=this.onClick(event),t.intMass=0,t.select(),t},t.prototype.isInside=function(t,i){return this.refresh(),t>=this.x-this.borderWidth/2&&t<=this.x+this.width+this.borderWidth/2&&i>=this.y-this.borderHeight/2&&i<=this.y+this.height+this.borderHeight/2?(this.booMouseOver=!0,!0):(this.booMouseOver=!1,!1)},t}();
var CanvasBoxConnector;CanvasBoxConnector=function(){function o(o,t){if(this.objElementFrom=o,this.objElementTo=t,null===this.objElementFrom)throw new CanvasBoxException("Canvas Box Line has no Element From on constructor");if(null===this.objElementTo)throw new CanvasBoxException("Canvas Box Line has no Element To on constructor");this.x=(this.objElementFrom.x+this.objElementTo.x)/2,this.y=(this.objElementFrom.y+this.objElementTo.y)/2,this.objBehavior=New.CanvasBoxConnectorBehavior(this)}return o.prototype.objBox=null,o.prototype.objElementFrom=null,o.prototype.objElementTo=null,o.prototype.x=0,o.prototype.y=0,o.prototype.z=0,o.prototype.dx=3,o.prototype.dy=3,o.prototype.objBehavior=null,o.prototype.objContext=null,o.prototype.strClassName="CanvasBoxConnector",o.prototype.isConnector=!0,o.prototype.booShowMenu=!1,o.prototype.objMenu=null,o.prototype.fixed=!1,o.prototype.dragdrop=!1,o.prototype.toSerialize=function(){var o;return o={x:this.x,y:this.y,dx:this.dx,dy:this.dy},o.objElementFrom=this.objBox.arrElements.indexOf(this.objElementFrom),o.objElementTo=this.objBox.arrElements.indexOf(this.objElementTo),o.strClassName=this.strClassName,o},o.prototype.loadMenu=function(){return this.objMenu=New.CanvasBoxMenu(),this.objMenu.objParent=this,this.objMenu.arrMenuItens={0:{name:"clone connector",event:function(o){return o.copy()}}}},o.prototype.initialize=function(o,t){return this.objElementFrom=o,this.objElementTo=t,this.objBehavior=New.CanvasBoxConnectorBehavior(this)},o.prototype.refresh=function(){},o.prototype.draw=function(){},o.prototype.isInside=function(){return!1},o.prototype.onMouseOver=function(o){return this.objBehavior.onMouseOver(o)},o.prototype.onMouseOut=function(o){return this.objBehavior.onMouseOut(o)},o.prototype.onMouseDown=function(o){return this.objBehavior.onMouseDown(o)},o.prototype.onClick=function(o){return this.objBehavior.onClick(o)},o.prototype.onDblClick=function(o){return this.objBehavior.onDblClick(o)},o.prototype.onDrag=function(o){return this.objBehavior.onDrag(o)},o.prototype.onDrop=function(o){return this.objBehavior.onDrop(o)},o.prototype.onTimer=function(o){return this.objBehavior.onTimer(o)},o.prototype.onContextMenu=function(){return this.objBox.booShowMenu=!this.objBox.booShowMenu,this.objBox.booShowMenu&&(this.loadMenu(),this.objMenu.intMenuX=this.objBox.mouseX,this.objMenu.intMenuY=this.objBox.mouseY,this.objMenu.objContext=this.objContext,this.objMenu.strActualMenuItem=null,this.objBox.objMenuSelected=this.objMenu),!1},o.prototype.getForce=function(o){return this.objBehavior.getForce(o)},o.prototype.clone=function(o){return this.cloneLine(o)},o.prototype.cloneLine=function(){var o;return this.intCloneCount++,this.intCloneCount>0&&this.intCloneCount%2===0?(o=New.CanvasBoxLine(this.objElementFrom,this),this.cloneConnector(o,!0)):(o=New.CanvasBoxLine(this,this.objElementTo),this.cloneConnector(o)),o},o.prototype.cloneConnector=function(o,t){return console.log("clone connector"),o?o.initialize(this,this.objElementTo):o=New.CanvasBoxConnector(this,this.objElementTo),o.objBehavior=New[this.objBehavior.strClassName](o),o.x=this.x,o.y=this.y,o.side=this.defaultSide?this.defaultSide:this.side,o.color=this.defaultColor?this.defaultColor:this.color,o.borderColor=this.defaultBorderColor?this.defaultBorderColor:this.borderColor,o.borderWidth=this.defaultBorderWidth?this.defaultBorderWidth:this.borderWidth,this.objBox.addElement(o),t?(o.objElementFrom=this.objElementFrom,o.objElementTo=this,this.objElementFrom=o,this.objElementTo&&(this.objElementTo.objElementFrom=this),this.objElementFrom&&(this.objElementFrom.objElementTo=this),o.objElementTo&&(o.objElementTo.objElementFrom=o),o.objElementFrom&&(o.objElementFrom.objElementTo=o)):(o.objElementFrom=this,this.objElementTo=o,this.objElementFrom&&(this.objElementFrom.objElementTo=this),this.objElementTo&&(this.objElementTo.objElementFrom=this),o.objElementFrom&&(o.objElementFrom.objElementTo=o),o.objElementTo&&(o.objElementTo.objElementFrom=o)),o},o.prototype.clone=function(o){return this.cloneConnector(o)},o.prototype.onDelete=function(){return console.log("connector on delete"),this.objElementFrom.isConnector&&(this.objElementFrom.objElementTo=this.objElementTo),this.objElementTo.isConnector?this.objElementTo.objElementFrom=this.objElementFrom:void 0},o.prototype.deleteCascade=function(){return this.deleteCascadeFrom(),this.deleteCascadeTo(),this.objBox.deleteElement(this,!1)},o.prototype.deleteCascadeTo=function(){return console.log("delete cascade"),is_object(this.objElementTo)&&this.objElementTo.isConnector?(-1!==this.objElementTo.getId()&&this.objElementTo.deleteCascadeTo(),this.objBox.deleteElement(this.objElementTo,!1)):void 0},o.prototype.deleteCascadeFrom=function(){return is_object(this.objElementFrom)&&this.objElementFrom.isConnector?(-1!==this.objElementFrom.getId()&&this.objElementFrom.deleteCascadeFrom(),this.objBox.deleteElement(this.objElementFrom,!1)):void 0},o.prototype.copy=function(){var o;return o=new window[this.strClassName],this.clone(o)},o.prototype.getId=function(){return this.objBox.arrElements.indexOf(this)},o.prototype.load=function(){},o}();
var CanvasBoxConnectorBehavior,__hasProp={}.hasOwnProperty,__extends=function(o,t){function e(){this.constructor=o}for(var n in t)__hasProp.call(t,n)&&(o[n]=t[n]);return e.prototype=t.prototype,o.prototype=new e,o.__super__=t.prototype,o};Load.CanvasBoxBehavior(),CanvasBoxConnectorBehavior=function(o){function t(o){this.objBoxElement=o,this.objBox=o.objBox}return __extends(t,o),t.prototype.objBox=null,t.prototype.objBoxElement=null,t.prototype.intXDistance=0,t.prototype.intYDistance=0,t.prototype.draw=function(){return this.objBoxElement.draw()},t.prototype.refresh=function(){return this.objBoxElement.refresh()},t.prototype.isInside=function(){return this.objBoxElement.isInside()},t.prototype.onTimer=function(){return this.move()},t.prototype.onMouseOver=function(o){return this.objBoxElement.drawMouseOver?this.objBoxElement.drawMouseOver(o):void 0},t.prototype.onMouseOut=function(o){return this.objBoxElement.drawMouseOut?this.objBoxElement.drawMouseOut(o):void 0},t.prototype.onDblClick=function(){return this.objBoxElement.drawFixed?this.objBoxElement.drawFixed(!this.objBoxElement.fixed):void 0},t.prototype.onDrag=function(){var o,t;return o=Math.round((this.objBoxElement.objElementFrom.x+this.objBoxElement.objElementTo.x)/2),t=Math.round((this.objBoxElement.objElementFrom.y+this.objBoxElement.objElementTo.y)/2),this.objBoxElement.booDrag=!0,this.intXDistance=this.objBoxElement.objBox.mouseX-o,this.intYDistance=this.objBoxElement.objBox.mouseY-t},t.prototype.onDrop=function(){return this.objBoxElement.booDrag=!1},t.prototype.onMouseDown=function(){},t.prototype.onClick=function(){},t.prototype.move=function(){return this.objBoxElement.fixed?void 0:this.objBoxElement.objElementFrom!==this.objBoxElement.objElementTo?(this.objBoxElement.x=(this.objBoxElement.objElementFrom.x+this.objBoxElement.objElementTo.x)/2+this.intXDistance,this.objBoxElement.y=(this.objBoxElement.objElementFrom.y+this.objBoxElement.objElementTo.y)/2+this.intYDistance):(Math.sqrt(this.intXDistance*this.intXDistance+this.intYDistance*this.intYDistance)<100&&(this.intXDistance=100,this.intYDistance=100),this.objBoxElement.x=this.objBoxElement.objElementFrom.x+this.intXDistance,this.objBoxElement.y=this.objBoxElement.objElementFrom.y+this.intYDistance)},t.prototype.getForce=function(){return null},t}(CanvasBoxBehavior);
var CanvasBoxElement;CanvasBoxElement=function(){function t(){this.init()}return t.prototype.objBox=null,t.prototype.x=0,t.prototype.relativeMousex=0,t.prototype.y=0,t.prototype.relativeMousey=0,t.prototype.z=1,t.prototype.dx=0,t.prototype.dy=0,t.prototype.objBehavior=null,t.prototype.objContext=null,t.prototype.strClassName="CanvasBoxElement",t.prototype.isConnector=!1,t.prototype.booShowMenu=!1,t.prototype.objMenu=null,t.prototype.fixed=!1,t.prototype.booDrag=!1,t.prototype.objMenu=null,t.prototype.booMouseOver=!1,t.prototype.arrButtons=Array(),t.prototype.intMass=1,t.prototype.dblRotate=0,t.prototype.toSerialize=function(){return objResult({x:this.x,y:this.y,mass:this.intMass,strClassName:strClassName}),objResult},t.prototype.init=function(){return this.objBehavior=New.CanvasBoxBehavior(this)},t.prototype.refresh=function(){return this.objBox.change(),this},t.prototype.onDraw=function(){return this.draw(),this},t.prototype.changeContext=function(){return this.objBox.moveTo(this.x,this.y),this.objBox.saveContext(),this.objBox.translate(this.x,this.y),this.dblRotate%(2*Math.PI)!==0&&this.objBox.rotate(this.dblRotate),this},t.prototype.restoreContext=function(){return this.objBox.restoreContext(),this.objBox.translate(0,0),this},t.prototype.draw=function(){throw New.CanvasBoxException("Draw Method was not properly defined in the "+strClassName)},t.prototype.onMouseOver=function(t){return this.booMouseOver=!0,this.objBehavior.onMouseOver(t)},t.prototype.onMouseOut=function(t){return this.booMouseOver=!1,this.objBehavior.onMouseOut(t)},t.prototype.onMouseDown=function(t){return this.objBehavior.onMouseDown(t)},t.prototype.onMouseOver=function(t){return this.objBehavior.onMouseOver(t)},t.prototype.isActive=function(){return 0!==this.intMass&&(null===this.objBox.objElementSelected||this.objBox.objElementSelected===this)},t.prototype.onClick=function(t){var o,e,r,n;if(!this.booDrag&&this.isActive())for(n=this.arrButtons,e=0,r=n.length;r>e;e++)if(o=n[e],o.booMouseOver)return o.onClick(t);return this.objBehavior.onClick(t)},t.prototype.onDblClick=function(t){return this.objBehavior.onDblClick(t)},t.prototype.onDrag=function(t){var o,e,r,n;if(this.booDrag=!0,this.isActive)for(n=this.arrButtons,e=0,r=n.length;r>e;e++)if(o=n[e],o.booMouseOver)return o.onDrag(t);return this.objBehavior.onDrag(t)},t.prototype.onDrop=function(t){return this.booDrag=!1,this.objBehavior.onDrop(t)},t.prototype.onTimer=function(t){return this.objBehavior.onTimer(t)},t.prototype.onContextMenu=function(){return this.objBox.booShowMenu=!this.objBox.booShowMenu,this.objBox.booShowMenu&&(this.objMenu.intMenuX=this.objBox.mouseX,this.objMenu.intMenuY=this.objBox.mouseY,this.objMenu.objBox=this.objBox,this.objMenu.strActualMenuItem=null,this.objBox.objMenuSelected=this.objMenu),!1},t.prototype.getForce=function(t){return this.objBehavior.getForce(t)},t.prototype.getConnectors=function(){var t,o,e,r,n;for(t=[],n=this.objBox.arrElements,e=0,r=n.length;r>e;e++)o=n[e],!php.is_object(o)||o.objElementFrom!==this&&o.objElementTo!==this||o===this||t.push(o);return t},t.prototype.onDelete=function(){var t,o,e,r;for(r=this.getConnectors(),o=0,e=r.length;e>o;o++)t=r[o],t.deleteCascade();return this},t.prototype.getId=function(){return this.objBox.arrElements.indexOf(this)},t.prototype.copy=function(){var t;return t=New[this.strClassName](),t.objBehavior=New[this.objBehavior.strClassName](t),t.x=Math.random()*this.objBox.width,t.y=Math.random()*this.objBox.height,this.objBox.addElement(t),t},t.prototype.select=function(){return this.objBox.objElementSelected=this,this.mass=0,this},t.prototype.load=function(){return null!==this.objMenu&&(this.objMenu.objBox=this.objBox),null!==this.objBehavior&&(this.objBehavior.objBox=this.objBox),this},t.prototype.setFixed=function(t){return this.fixed=t,this.draw(),this},t.prototype.goUp=function(){return this.setFixed(!0),this.y-=10,this},t.prototype.goDown=function(){return this.setFixed(!0),this.y+=10,this},t.prototype.goLeft=function(){return this.setFixed(!0),this.x-=10,this},t.prototype.goRight=function(){return this.setFixed(!0),this.x+=10,this},t.prototype.isInsideElement=function(){throw new CanvasBoxException("isInsideElement was not properly defined in the "+strClassName)},t.prototype.isInside=function(t,o){var e,r,n,i,s;if(e=!1,this.refresh(),this.isInsideElement(t,o)&&(e=!0),this.isActive())for(s=this.arrButtons,n=0,i=s.length;i>n;n++)r=s[n],r.isInside(t,o)&&(e=!0);return e},t.prototype.addButton=function(t){var o;return this.arrButtons.length>0&&(o=this.arrButtons[this.arrButtons.length-1],t.objPreviousButton=o),this.arrButtons.push(t),this},t.prototype.killMe=function(){return this.objBox.deleteElement(this)},t}();
var CanvasBoxException,__hasProp={}.hasOwnProperty,__extends=function(r,t){function e(){this.constructor=r}for(var o in t)__hasProp.call(t,o)&&(r[o]=t[o]);return e.prototype=t.prototype,r.prototype=new e,r.__super__=t.prototype,r};CanvasBoxException=function(r){function t(r){this.Message=r,console.log(r)}return __extends(t,r),t.prototype.objParentError=null,t.prototype.strParentErrorMessage=null,t.prototype.strMessage=null,t.prototype.setParentError=function(r){return window.bug=r,php.is_object(r)?(this.objParentError=r,this.strParentErrorMessage=php.method_exists("getMessage",r)?r.getMessage():r.message):this.strParentErrorMessage=r,console.log(this.strParentErrorMessage)},t.prototype.getMessage=function(){return this.strMessage+"\n"+this.strParentErrorMessage},t}(Error);
var CanvasBoxGravityBehavior,__hasProp={}.hasOwnProperty,__extends=function(t,o){function e(){this.constructor=t}for(var h in o)__hasProp.call(o,h)&&(t[h]=o[h]);return e.prototype=o.prototype,t.prototype=new e,t.__super__=o.prototype,t};Load.CanvasBoxBehavior(),CanvasBoxGravityBehavior=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return __extends(o,t),o.prototype.dblFriction=.8,o.prototype.dblGravityForce=.5,o.dblMaxForce=10,o.prototype.dblMinimalGravityForce=3,o.prototype.dblElasticityLoss=.99,o.prototype.move=function(){var t;return this.objBoxElement.refresh(),this.objBoxElement.fixed||this.objBoxElement.booDrag?!1:((null==this.objBoxElement.dy||isNaN(this.objBoxElement.dy))&&(this.objBoxElement.dy=0),(null==this.objBoxElement.dx||isNaN(this.objBoxElement.dx))&&(this.objBoxElement.dx=0),this.objBoxElement.x=Math.round(this.objBoxElement.x+this.objBoxElement.dx),this.objBoxElement.y=Math.round(this.objBoxElement.y+this.objBoxElement.dy),this.objBoxElement.refresh(),t=this.isLastOne(this.objBoxElement),t?this.objBoxElement.dy+=this.dblGravityForce:(this.objBoxElement.dy=-1*Math.abs(this.objBoxElement.dy),this.objBoxElement.dy*=-this.dblFriction),this.objBoxElement.dy>this.dblMaxForce&&(this.objBoxElement.dy=this.dblMaxForce),this.objBoxElement.dy<-this.dblMaxForce&&(this.objBoxElement.dy=-this.dblMaxForce),this.objBoxElement.dx>this.dblMaxForce&&(this.objBoxElement.dx=this.dblMaxForce),this.objBoxElement.dx<-this.dblMaxForce&&(this.objBoxElement.dx=-this.dblMaxForce),(0!==Math.round(this.objBoxElement.dx)||0!==Math.round(this.objBoxElement.dy))&&(this.objBoxElement.objBox.booChanged=!0),this.objBoxElement.x=Math.round(this.objBoxElement.x+this.objBoxElement.dx),this.objBoxElement.y=Math.round(this.objBoxElement.y+this.objBoxElement.dy),this.objBoxElement.dx*=this.dblElasticityLoss,this.objBoxElement.dy*=this.dblElasticityLoss,this.objBoxElement.x0<0&&(this.objBoxElement.x=this.objBoxElement.width/2,this.objBoxElement.dx=-this.objBoxElement.dx-1,Math.abs(this.objBoxElement.dx)<this.dblMinimalGravityForce&&(this.objBoxElement.dx=0)),this.objBoxElement.x1>this.objBoxElement.objBox.width&&(this.objBoxElement.x=this.objBoxElement.objBox.width-this.objBoxElement.width/2,this.objBoxElement.dx=-this.objBoxElement.dx+1,Math.abs(this.objBoxElement.dx)<this.dblMinimalGravityForce&&(this.objBoxElement.dx=0)),this.objBoxElement.y0<0&&(this.objBoxElement.y=this.objBoxElement.height/2,this.objBoxElement.dy=-this.objBoxElement.dy-1,Math.abs(this.objBoxElement.dy)<this.dblMinimalGravityForce&&(this.objBoxElement.dy=0)),this.objBoxElement.y1>this.objBoxElement.objBox.height&&(this.objBoxElement.y=Math.round(this.objBoxElement.objBox.height-this.objBoxElement.height/2),this.objBoxElement.dy=-Math.round(.8*this.objBoxElement.dy*10)/10,Math.abs(this.objBoxElement.dy)<this.dblMinimalGravityForce&&(this.objBoxElement.dy=0)),this.objBoxElement.refresh(),o.__super__.move.apply(this,arguments))},o.prototype.isLastOne=function(t){var o,e,h,i,n,s,x,l,b,d,r,a;for(o=this.objBoxElement.objBox.arrElements,b=o.length,l=Math.round(t.y-t.height/2),n=Math.round(t.y+t.height/2),x=Math.round(t.x+t.width/2),s=Math.round(t.x-t.width/2),h=!0,i=0,r=0,a=o.length;a>r;r++)d=o[r],d.isConnector||d.getId()===t.getId()||(e=!1,!e&&Math.round(d.x+d.width/2)>=s&&Math.round(d.x+d.width/2)<=x&&Math.round(d.y+d.height/2)>=l&&Math.round(d.y+d.height/2)<=n&&(e=!0),!e&&Math.round(d.x-d.width/2)>=s&&Math.round(d.x-d.width/2)<=x&&Math.round(d.y+d.height/2)>=l&&Math.round(d.y+d.height/2)<=n&&(e=!0),!e&&Math.round(d.x+d.width/2)>=s&&Math.round(d.x+d.width/2)<=x&&Math.round(d.y-d.height/2)>=l&&Math.round(d.y-d.height/2)<=n&&(e=!0),!e&&Math.round(d.x-d.width/2)>=s&&Math.round(d.x-d.width/2)<=x&&Math.round(d.y-d.height/2)>=l&&Math.round(d.y-d.height/2)<=n&&(e=!0),e&&(h=h&&t.y>=d.y));return h},o.prototype.onDrag=function(t){return this.objBoxElement.dx=this.objBoxElement.objBox.mouseX-this.objBoxElement.x,this.objBoxElement.dy=this.objBoxElement.objBox.mouseY-this.objBoxElement.y,o.__super__.onDrag.call(this,t)},o}(CanvasBoxBehavior);
var CanvasBoxLine,__hasProp={}.hasOwnProperty,__extends=function(t,o){function e(){this.constructor=t}for(var r in o)__hasProp.call(o,r)&&(t[r]=o[r]);return e.prototype=o.prototype,t.prototype=new e,t.__super__=o.prototype,t};Load.CanvasBoxConnector(),CanvasBoxLine=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return __extends(o,t),o.prototype.intMass=1,o.prototype.side=1,o.prototype.hoverSide=5,o.prototype.shaddow=20,o.prototype.shaddowColor="rgba(100,100,100,0.5)",o.prototype.hoverDistance=10,o.prototype.x=0,o.prototype.y=0,o.prototype.x0=0,o.prototype.x1=0,o.prototype.dx=0,o.prototype.y0=0,o.prototype.y1=0,o.prototype.dy=0,o.prototype.draggableColor="rgb( 200, 200, 220 )",o.prototype.draggableBorderColor="rgb( 200, 200, 220 )",o.prototype.strokeStyle="rgb( 200, 200, 220 )",o.prototype.fillStyle="rgb( 100, 100, 220 )",o.prototype.width=3,o.prototype.strClassName="CanvasBoxLine",o.prototype.color="black",o.prototype.strText=null,o.prototype.toSerialize=function(){var t;return t={side:this.side,x0:this.x0,x1:this.x1,dx:this.dx,y0:this.y0,y1:this.y1,dy:this.dy,draggableColor:this.draggableColor,draggableBorderColor:this.draggableBorderColor,strokeStyle:this.strokeStyle,width:this.width,strClassName:this.strClassName}},o.prototype.getVectorFromElement=function(t){var o,e,r,i;return i=this.findArrow(t,this.side),o=2*i.degree*Math.PI/360,e=2*Math.PI-o,r=Math.abs(Math.cos(o))*t.height/2,r+=Math.abs(Math.sin(o))*t.width/2,{pointer:i,distance:r,angle:o,reverseAngle:e}},o.prototype.rotateVector=function(t){return this.objBox.restoreContext(),this.objBox.moveTo(t.pointer.x,t.pointer.y),this.objBox.saveContext(),this.objBox.translate(t.pointer.x,t.pointer.y),this.objBox.rotate(t.reverseAngle),this.objBox.translate(0,t.distance)},o.prototype.createConnectorFrom=function(){var t;return t=this.getVectorFromElement(this.objElementFrom),this.rotateVector(t),this.drawConnectorFrom(t.pointer,this.side),this.objBox.restoreContext()},o.prototype.createConnectorTo=function(){var t;return t=this.getVectorFromElement(this.objElementTo),this.rotateVector(t),this.drawConnectorTo(t.pointer,this.side),this.objBox.restoreContext()},o.prototype.drawConnectorFrom=function(t,o){return this.drawBackgroundCircle(o),this.objBox.setFillStyle(this.fillStyle),this.objBox.setStrokeStyle(this.strokeStyle),this.objBox.beginPath(),this.drawArrowFrom(o),this.objBox.fill(),this.objBox.stroke()},o.prototype.drawConnectorTo=function(t,o){return this.drawBackgroundCircle(o),this.objBox.setFillStyle(this.fillStyle),this.objBox.setStrokeStyle(this.strokeStyle),this.objBox.beginPath(),this.drawArrowTo(o),this.objBox.fill(),this.objBox.stroke()},o.prototype.drawBackgroundCircle=function(){return this.objBox.beginPath(),this.objBox.setFillStyle(this.objBox.backgroundColor),this.objBox.setStrokeStyle("rgb( 0 , 0, 0 )"),this.objBox.arc(0,0,this.shaddow,0,Math.PI,!0),this.objBox.fill()},o.prototype.refresh=function(){return this.x0=this.x-this.side/2,this.x1=this.x+this.side/2,this.y0=this.y-this.side/2,this.y1=this.y+this.side/2,this.x0<0?(this.x+=this.side,this.refresh()):this.y0<0?(this.y+=this.side,this.refresh()):(this.width=this.side,this.height=this.side)},o.prototype.drawLine=function(t,o,e,r){return this.objBox.drawLine(t,o,e,r)},o.prototype.drawQuadraticLine=function(t,o,e,r,i,s){return this.objBox.drawBezierLine(t,o,e,r,i,s)},o.prototype.getMouseDistance=function(){var t,o;return t=this.objBox.mouseX-this.x,o=this.objBox.mouseY-this.y,t*=t,o*=o,Math.round(Math.sqrt(t+o))},o.prototype.drawAnchor=function(){var t,o;return this.objBox.saveContext(),this.objBox.setFillStyle(this.color),this.objBox.setStrokeStyle(this.strokeStyle),this.objBox.moveTo(this.x,this.y),t=this.getMouseDistance()/8,o=0,t<this.hoverDistance&&(o=this.hoverDistance-t),(this.mouseOver||this.objBox.objElementClicked===this||this.objBox.objElementClicked===this.objElementFrom||this.objBox.objElementClicked===this.objElementTo)&&(o=this.hoverDistance),o>0&&(this.objBox.beginPath(),this.objBox.setFillStyle(this.shaddowColor),this.objBox.arc(this.x,this.y,o,0,2*Math.PI,!0),this.objBox.fill()),this.objBox.closePath(),this.objBox.restoreContext()},o.prototype.drawLines=function(){return this.objBox.saveContext(),this.objBox.moveTo(this.x,this.y),this.objBox.setStrokeStyle(this.strokeStyle),this.objBox.setFillStyle(this.color),this.drawQuadraticLine(this.objElementFrom.x,this.objElementFrom.y,this.objElementTo.x,this.objElementTo.y,this.x,this.y),this.objBox.stroke(),this.objBox.restoreContext()},o.prototype.draw=function(){if(null===this.objElementFrom)throw new CanvasBoxException("Canvas Box Line has no Element From");if(null===this.objElementTo)throw new CanvasBoxException("Canvas Box Line has no Element To");return this.refresh(),this.drawLines(),this.drawAnchor(),this.drawText(),this.createConnectorFrom(),this.createConnectorTo()},o.prototype.drawArrowTo=function(){},o.prototype.drawArrowFrom=function(){},o.prototype.drawText=function(){return null==this.strText?null:(this.objBox.setFillStyle("black"),this.objBox.setFont("Arial 40px"),this.objBox.fillText(this.strText,this.x,this.y))},o.prototype.findArrow=function(t){var o;return o=Math.round(180+180*Math.atan2(t.x-this.x,t.y-this.y)/Math.PI),{degree:o,x:t.x,y:t.y}},o.prototype.isInside=function(t,o){var e;return this.refresh(),t>=this.x0&&t<=this.x1&&o>=this.y0&&o<=this.y1?!0:(e=this.getMouseDistance(),e<this.hoverDistance?!0:!1)},o.prototype.drawMouseOver=function(){return this.defaultSide||(this.defaultSide=this.side),this.side=6},o.prototype.drawFixed=function(t){return this.defaultColor||(this.defaultColor=this.color),t?(this.borderWidth*=3,this.side=this.defaultSide):(this.borderWidth=1,this.side=this.defaultSide)},o.prototype.drawMouseOut=function(){return this.side=this.defaultSide},o.prototype.onDraw=function(){return this.draw()},o}(CanvasBoxConnector);
var CanvasBoxMagneticBehavior,__hasProp={}.hasOwnProperty,__extends=function(t,o){function e(){this.constructor=t}for(var n in o)__hasProp.call(o,n)&&(t[n]=o[n]);return e.prototype=o.prototype,t.prototype=new e,t.__super__=o.prototype,t};Load.CanvasBoxBehavior(),CanvasBoxMagneticBehavior=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return __extends(o,t),o.prototype.intMagnetism=40,o.prototype.intWallRepelsForce=.1,o.prototype.intDirectionChangeLoss=100,o.prototype.intMaxForce=10,o.prototype.intMargin=10,o.prototype.intRepelling=20,o.prototype.intEscapeForce=.05,o.prototype.dblCollisionForce=0,o.prototype.strClassName="CanvasBoxMagneticBehavior",o.prototype.toSerialize=function(){var t;return t=Array(),t.dragdrop=this.dragdrop,t.intMargin=this.intMargin,t.intEscapeForce=this.intEscapeForce,t.dblCollisionForce=this.dblCollisionForce,t.strClassName=this.strClassName,t},o.prototype.initialize=function(t){return this.objBoxElement=t,this.intMagnetism?void 0:this.intMagnetism=1},o.prototype.repelsWalls=function(t){var o,e,n;return n=void 0,e=void 0,e=this.objBoxElement&&this.objBoxElement.objBox?this.objBoxElement.objBox.dblZoom:1,o=this.intWallRepelsForce*this.objBoxElement.objBox.arrElements.length*e,n=Array(),n.dx=-1*this.objBoxElement.x*o,n.dy=0,t.push(n),n=Array(),n.dx=1*(this.objBoxElement.objBox.width-this.objBoxElement.x)*o,n.dy=0,t.push(n),n=Array(),n.dx=0,n.dy=-1*this.objBoxElement.y*o,t.push(n),n=Array(),n.dx=0,n.dy=1*(this.objBoxElement.objBox.height-this.objBoxElement.y)*o,t.push(n),t},o.prototype.repelsElements=function(t){var o,e,n,i,r;for(r=this.objBoxElement.objBox.arrElements,n=0,i=r.length;i>n;n++)o=r[n],o!==this.objBoxElement&&(e=this.getElementForce(o,this.objBoxElement),null!=e&&t.push(e),e=this.getConnectorForce(o,this.objBoxElement),null!=e&&t.push(e));return t},o.prototype.keepOnLimits=function(t){var o;return o=Array(),o.dx=0,o.dy=0,o.dx+=1*Math.abs(this.intEscapeForce+(this.objBoxElement.objBox.width-this.objBoxElement.x)),o.dx+=-1*Math.abs(this.intEscapeForce+this.objBoxElement.x),o.dy+=1*Math.abs(this.intEscapeForce+(this.objBoxElement.objBox.height-this.objBoxElement.y)),o.dy+=-1*Math.abs(this.intEscapeForce+this.objBoxElement.y),(0!==o.dx||0!==o.dy)&&t.push(o),t},o.prototype.hasChanged=function(){var t;return t=!1,this.objBoxElement.x<this.intMargin&&(this.objBoxElement.x=this.intMargin,t=!0),this.objBoxElement.x+this.intMargin>this.objBoxElement.objBox.width&&(this.objBoxElement.x=Math.round(this.objBoxElement.objBox.width-this.intMargin),t=!0),this.objBoxElement.y<this.intMargin&&(this.objBoxElement.y=this.intMargin,t=!0),this.objBoxElement.y+this.intMargin>this.objBoxElement.objBox.height&&(this.objBoxElement.y=Math.round(this.objBoxElement.objBox.height-this.intMargin),t=!0),t},o.prototype.move=function(){var t;if(!this.objBoxElement.fixed&&!this.objBoxElement.dragdrop)return t=Array(),t=this.repelsWalls(t),t=this.repelsElements(t),t=this.keepOnLimits(t),this.objBoxElement.dx=Math.round(this.objBoxElement.dx),this.objBoxElement.dy=Math.round(this.objBoxElement.dy),isNaN(this.objBoxElement.dx)&&(this.objBoxElement.dx=0),isNaN(this.objBoxElement.dy)&&(this.objBoxElement.dy=0),this.getVectors(t),(0!==Math.round(this.objBoxElement.dx)||0!==Math.round(this.objBoxElement.dy))&&(this.objBoxElement.objBox.booChanged=!0,this.objBoxElement.x=Math.round(this.objBoxElement.x+this.objBoxElement.dx),this.objBoxElement.y=Math.round(this.objBoxElement.y+this.objBoxElement.dy)),this.hasChanged()},o.prototype.onTimer=function(){return this.move()},o.prototype.onMouseOver=function(t){return this.objBoxElement.drawMouseOver?this.objBoxElement.drawMouseOver(t):void 0},o.prototype.onMouseOut=function(t){return this.objBoxElement.drawMouseOut?this.objBoxElement.drawMouseOut(t):void 0},o.prototype.onDblClick=function(){return this.objBoxElement.fixed=!this.objBoxElement.fixed,this.objBoxElement.drawFixed?this.objBoxElement.drawFixed(this.objBoxElement.fixed):void 0},o.prototype.onDrag=function(){return this.objBoxElement.dragdrop=!0,this.objBoxElement.dx=this.objBoxElement.objBox.mouseX-this.objBoxElement.x,this.objBoxElement.dy=this.objBoxElement.objBox.mouseY-this.objBoxElement.y,this.objBoxElement.x=this.objBoxElement.objBox.mouseX,this.objBoxElement.y=this.objBoxElement.objBox.mouseY,this.objBoxElement.drawDrag?this.objBoxElement.drawDrag():void 0},o.prototype.onDrop=function(){return this.objBoxElement.dragdrop=!1,this.objBoxElement.drawDrop?this.objBoxElement.drawDrop():void 0},o.prototype.getVectors=function(t){var o,e,n,i,r,s,h;if(s=t.length,0===t.length)return this.objBoxElement.dx=0,void(this.objBoxElement.dy=0);for(o=0,e=0,r=0;s>r;)h=t[r],o+=h.dx,e+=h.dy,++r;return n=Math.round(o/s),i=Math.round(e/s),n>this.intMaxForce&&(n=this.intMaxForce),n<-this.intMaxForce&&(n=-this.intMaxForce),i>this.intMaxForce&&(i=this.intMaxForce),i<-this.intMaxForce&&(i=-this.intMaxForce),this.objBoxElement.dx=n,this.objBoxElement.dy=i},o.prototype.getConnectorForce=function(t,o){var e,n,i,r,s,h,x,l,a,d,y,b;return!t.isConnector&&o.isConnector?(e=this.getConnectorForce(o,t),null!=e&&(e.dx*=-1,e.dy*=-1),e):t.isConnector?t.objElementFrom!==o&&t.objElementTo!==o?null:(i=t.x-o.x,s=t.y-o.y,r=i*i,h=s*s,n=Math.round(100*Math.sqrt(r+h))/100,l=100,b=2,y=0,x=Math.round(100*n/l)/100,x=Math.round(100*Math.pow(x,b))/100,x>y?(a=Math.round(100*x*Math.round(100*i/n))/100,d=Math.round(100*x*Math.round(100*s/n))/100,e=Array(),e.dx=a,e.dy=d,e):null):null},o.prototype.getElementForce=function(t,o){var e,n,i,r,s,h,x,l,a,d;return d=Array(),d.dx=0,d.dy=0,e=!1,l=o.x<t.x?-1:1,a=o.y<t.y?-1:1,h=o.x-t.x,x=o.y-t.y,i=Math.sqrt(h*h+x*x),i>1?(r=t.objBox.width/i,s=t.objBox.height/i):(r=0,s=0),!e&&o.x1&&o.x0&&o.y1&&o.y0&&this.objBoxElement.x1&&t.x0&&t.y1&&t.y0&&o.x0>=t.x0&&o.x0<=t.x1&&o.y0>=t.y0&&o.y0<=t.y1&&(d.dx-=this.intRepelling+Math.round((t.x1-o.x0)*this.dblCollisionForce),d.dy-=this.intRepelling+Math.round((t.y1-o.y0)*this.dblCollisionForce),e=!0),!e&&o.x1&&o.x0&&o.y1&&o.y0&&t.x1&&t.x0&&t.y1&&t.y0&&o.x0<=t.x1&&o.x0>=t.x0&&o.y1<=t.y1&&o.y1>=t.y0&&(d.dx-=this.intRepelling+Math.round((t.x1-o.x0)*this.dblCollisionForce),d.dy+=this.intRepelling+Math.round((o.y1-t.y0)*this.dblCollisionForce),e=!0),!e&&o.x1&&o.x0&&o.y1&&o.y0&&t.x1&&t.x0&&t.y1&&t.y0&&o.x1<=t.x1&&o.x1>=t.x0&&o.y0<=t.y1&&o.y0>=t.y0&&(d.dx+=this.intRepelling+Math.round((o.x1-t.x0)*this.dblCollisionForce),d.dy-=this.intRepelling+Math.round((t.y0-o.y0)*this.dblCollisionForce),e=!0),!e&&o.x1&&o.x0&&o.y1&&o.y0&&t.x1&&t.x0&&t.y1&&t.y0&&o.x1>=t.x1&&o.x1<=t.x0&&o.y1>=t.y0&&o.y1<=t.y1&&(d.dx+=this.intRepelling+Math.round((o.x1-t.x0)*this.dblCollisionForce),d.dy+=this.intRepelling+Math.round((o.y1-t.y0)*this.dblCollisionForce),e=!0),d.dx+=this.intMagnetism*l*r,d.dy+=this.intMagnetism*a*s,n=Math.round(100*Math.sqrt(d.dx*d.dx+d.dy*d.dy))/100,d.dx+=Math.round(100*this.intRepelling+(Math.random(n)-n/2)/this.intDirectionChangeLoss)/100,d.dy+=Math.round(100*this.intRepelling+(Math.random(n)-n/2)/this.intDirectionChangeLoss)/100,e&&(d.dx+=Math.round(100*(Math.random()*n-n/2)/this.intDirectionChangeLoss)/100,d.dy+=Math.round(100*(Math.random()*n-n/2)/this.intDirectionChangeLoss)/100,d.dx+=Math.round(100*(Math.random()*n-n/2)/this.intDirectionChangeLoss)/100,d.dy+=Math.round(100*(Math.random()*n-n/2)/this.intDirectionChangeLoss)/100),d},o}(CanvasBoxBehavior);
var CanvasBoxMenu;CanvasBoxMenu=function(){function t(){}return t.prototype.strClassName="CanvasBoxMenu",t.prototype.menuBorderColor="rgb( 100 , 100 , 200 )",t.prototype.menuBorderWidth=1,t.prototype.menuFillColor="rgba( 230, 230, 240 , 0.7 )",t.prototype.menuItemBorderColor="rgb( 100 , 100 , 200 )",t.prototype.menuItemBorderWidth=1,t.prototype.menuItemFillColor="rgba( 230, 230, 240 , 0.7 )",t.prototype.menuItemTextColor="blue",t.prototype.menuSelectedItemFillColor="rgba( 230, 230, 140 , 0.7 )",t.prototype.intMenuX=0,t.prototype.intMenuY=0,t.prototype.intMenuItemXBorder=3,t.prototype.intMenuItemHeight=20,t.prototype.intMenuWidth=110,t.prototype.arrMenuItens=Array(),t.prototype.strCurrentMenuItem=null,t.prototype.mouseX=0,t.prototype.mouseY=0,t.prototype.objBox=null,t.prototype.objParent=null,t.prototype.objOpenChildMenu=null,t.prototype.draw=function(){var t,e,n,i,o,r,s,u;for(this.strCurrentMenuItem=null,t=php.array_keys(this.arrMenuItens),this.intMenuHeight=this.intMenuItemHeight*(t.length-1),this.objBox.setStrokeStyle(this.menuBorderColor),this.objBox.setLineWidth(this.menuBorderWidth),this.objBox.strokeRect(this.intMenuX,this.intMenuY,this.intMenuWidth,this.intMenuHeight),this.objBox.setFillStyle(this.menuFillColor),this.objBox.fillRect(this.intMenuX,this.intMenuY,this.intMenuWidth,this.intMenuHeight),e=r=0,s=t.length;s>r;e=++r)o=t[e],n=this.intMenuX,i=this.intMenuY+e*this.intMenuItemHeight,this.objBox.setStrokeStyle(this.menuItemBorderColor),this.objBox.setLineWidth(this.menuItemBorderWidth),this.objBox.strokeRect(n,i,this.intMenuWidth,this.intMenuItemHeight),this.mouseX>n&&this.mouseX<n+this.intMenuWidth&&this.mouseY>i&&this.mouseY<i+this.intMenuItemHeight?(this.objBox.setFillStyle(this.menuSelectedItemFillColor),this.strCurrentMenuItem=o):this.objBox.setFillStyle(this.menuItemFillColor),this.objBox.fillRect(n,i,this.intMenuWidth,this.intMenuItemHeight),this.objBox.setFillStyle(null!=(u=this.arrMenuItens[o].backgroundColor)?u:this.menuItemTextColor),this.objBox.setLineWidth(.9),this.objBox.setFont("10px Times New Roman"),this.objBox.setTextAlign("left"),this.objBox.fillText(this.arrMenuItens[o].name,this.intMenuItemXBorder+n,Math.round(i+this.intMenuItemHeight/2));return null!=this.objOpenChildMenu?(this.objOpenChildMenu.mouseX=this.mouseX,this.objOpenChildMenu.mouseY=this.mouseY,this.objOpenChildMenu.draw()):void 0},t.prototype.onClick=function(t){var e,n;return e=!1,null!=this.strCurrentMenuItem&&(n=this.arrMenuItens[this.strCurrentMenuItem].event,!Object.isUndefined(n)&&Object.isFunction(n)&&(this.arrMenuItens[this.strCurrentMenuItem].key=this.strCurrentMenuItem,e=n(this.objParent,this.arrMenuItens[this.strCurrentMenuItem],this))),e||null==this.objOpenChildMenu||(this.objOpenChildMenu.mouseX=this.mouseX,this.objOpenChildMenu.mouseY=this.mouseY,e=this.objOpenChildMenu.onClick(t)),e||(this.strCurrentMenuItem=null,this.objOpenChildMenu=null),e},t.prototype.onDraw=function(t){return null==t&&(t=null),this.draw(),!0},t.prototype.createChildMenu=function(t,e){var n;return n=new autoload.newCanvasBoxMenu,n.objBox=this.objBox,n.intMenuWidth=this.intMenuWidth,n.intMenuX=this.intMenuX+this.intMenuWidth+1,n.intMenuY=this.intMenuY+this.intMenuItemHeight*t.key,n.intMenuItemXBorder=this.intMenuItemXBorder,n.arrMenuItens=e,n.intMenuItemHeight=this.intMenuItemHeight,n.objParent=this.objParent,this.objOpenChildMenu=n,!0},t}();
var CanvasBoxPointer;CanvasBoxPointer=function(){function t(t){null==t&&(t=null),null!=t&&(null!=t.x&&(this.x=t.x),null!=t.y&&(this.y=t.y),null!=t.x1&&(this.objControl1.x=t.x1),null!=t.y1&&(this.objControl1.y=t.y1),null!=t.x2&&(this.objControl2.x=t.x2),null!=t.y2&&(this.objControl2.y=t.y2),null!=t.strokeStyle&&(this.strokeStyle=t.strokeStyle),null!=t.lineWidth&&(this.lineWidth=t.lineWidth))}var o;return o="CanvasBoxPointer",t.prototype.x=0,t.prototype.y=0,t.prototype.lineWidth=null,t.prototype.strokeStyle=null,t.prototype.objControl1={x:0,y:0},t.prototype.objControl2={x:0,y:0},t.prototype.toSerialize=function(){return{x:this.x,y:this.y,x1:this.objControl1.x,y1:this.objControl1.y,x2:this.objControl2.x,y2:this.objControl2.y,lineWidth:this.lineWidth,strokeStyle:this.strokeStyle}},t.prototype.hasSomeBezierControl=function(){return 0!==this.objControl1.x||0!==this.objControl1.y||0!==this.objControl2.x||0!==this.objControl2.y},t.prototype.round=function(t){return null==t&&(t=50),this.objControl1.x=10,this.objControl1.y=10},t.prototype.rotatePoint=function(t,o){var n,r;return n=Math.cos(o)*t.x-Math.sin(-o)*t.y,r=-(Math.cos(o)*t.y-Math.sin(o)*t.x),{x:n,y:r}},t.prototype.rotate=function(t){return!1},t.prototype.toString=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),"["+this.x+","+this.y+"]"},t}();
var CanvasBoxPolygon,__hasProp={}.hasOwnProperty,__extends=function(t,o){function r(){this.constructor=t}for(var i in o)__hasProp.call(o,i)&&(t[i]=o[i]);return r.prototype=o.prototype,t.prototype=new r,t.__super__=o.prototype,t};Load.CanvasBoxElement(),CanvasBoxPolygon=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return __extends(o,t),o.prototype.debug=!1,o.prototype.color=null,o.prototype.borderColor=null,o.prototype.borderWidth=1,o.prototype.dblRotate=0,o.prototype.arrPoints=null,o.prototype.strClassName="Polygon",o.prototype.init=function(){return o.__super__.init.call(this),this.arrPoints=new Array},o.prototype.toSerialize=function(){var t;return t=o.__super__.toSerialize.call(this),t.arrPoints=this.serializePoints(),t.dblRotate=this.dblRotate,t},o.prototype.serializePoints=function(){var t,o,r,i,e,n;for(t=new Array,n=this.arrPoints,i=0,e=n.length;e>i;i++)o=n[i],r=o instanceof CanvasBoxPointer?o.toSerialize():o,t.push(r);return t},o.prototype.getRotatedPoints=function(){var t,o,r,i,e;for(t=new Array,e=this.arrPoints,r=0,i=e.length;i>r;r++)o=e[r],t.push(this.rotatePoint(o));return t},o.prototype.addPoint=function(t){return t.position=this.arrPoints.length,this.arrPoints.push(t),this},o.prototype.draw=function(){var t,r,i,e,n,s,h,a,l,p,y,u,d,x;if(this.arrPoints.length<2)return o.__super__.draw.call(this);for(this.changeContext(),this.objBox.setFillStyle(this.color),this.objBox.setStrokeStyle(this.borderColor),this.objBox.lineWidth=""+this.borderWidth+"px",t=this.getRotatedPoints(),n=t[0],this.objBox.beginPath(),d=this.arrPoints,r=l=0,y=d.length;y>l;r=++l)h=d[r],s=this.arrPoints[(r+1)%this.arrPoints.length],a=this.arrPoints[(r-1+this.arrPoints.length)%this.arrPoints.length],0===r&&this.objBox.moveTo(h.x,h.y),h instanceof CanvasBoxPointer&&(null!=h.strokeStyle&&this.objBox.setStrokeStyle(h.strokeStyle),null!=h.lineWidth&&this.objBox.setLineWidth(h.lineWidth)),this.objBox.lineTo(h.x,h.y);if(this.objBox.fill(),this.objBox.stroke(),this.debug)for(x=this.arrPoints,r=p=0,u=x.length;u>p;r=++p)h=x[r],a=this.arrPoints[(r-1+this.arrPoints.length)%this.arrPoints.length],h instanceof CanvasBoxPointer&&(null!=h.strokeStyle&&this.objBox.setStrokeStyle(h.strokeStyle),null!=h.lineWidth&&this.objBox.setLineWidth(h.lineWidth),e=this.middle(a,h),i=this.middle(h,s),this.objBox.setStrokeStyle("black"),this.objBox.strokeText(r,h.x,h.y));return this.restoreContext(),this},o.prototype.isInsideElement=function(t,o){var r;return r=New.CanvasBoxPointer({x:t,y:o}),this.isInsidePolygon(r)},o.prototype.isInsidePolygon=function(t){var o,r,i,e,n,s,h,a,l,p,y,u,d,x;if(t.x=this.x-t.x,t.y=this.y-t.y,o=this.getRotatedPoints(),a=o.length,3>a)return!1;for(r=!1,u=o[a-1],s=d=0,x=o.length;x>d;s=++d)y=o[s],y.x>u.x?(l=u,p=y):(p=u,l=y),i=y.x<t.x,h=t.x<=u.x,n=Math.round((t.y-l.y)*(p.x-l.x)),e=Math.round((p.y-l.y)*(t.x-l.x)),i===h&&e>n&&(r=!r),u=y;return r},o.prototype.rotatePoint=function(t){var o,r;return o=Math.round(Math.cos(this.dblRotate)*t.x-Math.sin(-this.dblRotate)*t.y),r=-Math.round(Math.cos(this.dblRotate)*t.y-Math.sin(this.dblRotate)*t.x),New.CanvasBoxPointer({x:o,y:r})},o.prototype.smooth=function(){var t,o,r,i,e,n,s,h,a,l,p,y;for(t=new Array,y=this.arrPoints,o=l=0,p=y.length;p>l;o=++l)h=y[o],s=this.arrPoints[(o+1)%this.arrPoints.length],r=this.arrPoints[(o-1+this.arrPoints.length)%this.arrPoints.length],i=this.middle(r,h),e=this.middle(h,s),a=this.middle(i,e),n=this.middle(a,h),t.push(n),t.push(e);return this.arrPoints=t},o.prototype.middle=function(t,o){var r;return r=New.CanvasBoxPointer({x:(t.x+o.x)/2,y:(t.y+o.y)/2})},o}(CanvasBoxElement);
var CanvasBoxRender;CanvasBoxRender=function(){function t(){window.addEventListener("hashchange",function(t){return function(o){return t.load(o)}}(this)),this.load()}return t.prototype.strSeparator=" ,",t.prototype.loadUrl=function(){return window.location.hash.substring(1)},t.prototype.updateUrl=function(t){return window.location.hash=t,this},t.prototype.load=function(){var t,o,n,r;for(t=php.explode(this.strSeparator,this.loadUrl()),n=0,r=t.length;r>n;n++)o=t[n],this.loadHash(o);return this},t.prototype.loadHash=function(t){return console.log(t)},t}();
var Load,New,arrScripts,key,objScript;Load=function(){function o(){}return o}(),New=function(){function o(){}return o}(),arrScripts=document.head.getElementsByTagName("script");for(key in arrScripts)if(objScript=arrScripts[key],objScript.src.indexOf("New.js")>0){window.MAIN_PATH=objScript.src.replace("New.js","");break}New.prototype.arrMap={CanvasBox:""+window.MAIN_PATH+"CanvasBox",CanvasBoxBehavior:""+window.MAIN_PATH+"CanvasBoxBehavior",CanvasBoxButton:""+window.MAIN_PATH+"CanvasBoxButton",CanvasBoxConnector:""+window.MAIN_PATH+"CanvasBoxConnector",CanvasBoxElement:""+window.MAIN_PATH+"CanvasBoxElement",CanvasBoxException:""+window.MAIN_PATH+"CanvasBoxException",CanvasBoxLine:""+window.MAIN_PATH+"CanvasBoxLine",CanvasBoxMenu:""+window.MAIN_PATH+"CanvasBoxMenu",CanvasBoxPointer:""+window.MAIN_PATH+"CanvasBoxPointer",CanvasBoxPolygon:""+window.MAIN_PATH+"CanvasBoxPolygon",CanvasBoxExportButton:""+window.MAIN_PATH+"button/CanvasBoxExportButton",CanvasBoxFixedButton:""+window.MAIN_PATH+"button/CanvasBoxFixedButton",CanvasBoxSaveButton:""+window.MAIN_PATH+"button/CanvasBoxSaveButton",CanvasBoxZoomInButton:""+window.MAIN_PATH+"button/CanvasBoxZoomIntButton",CanvasBoxZoomOutButton:""+window.MAIN_PATH+"button/CanvasBoxZoomOutButton",CanvasBoxConnectorBehavior:""+window.MAIN_PATH+"CanvasBoxConnectorBehavior",CanvasBoxGravityBehavior:""+window.MAIN_PATH+"CanvasBoxGravityBehavior",CanvasBoxMagneticBehavior:""+window.MAIN_PATH+"CanvasBoxMagneticBehavior",CanvasBoxRender:""+window.MAIN_PATH+"CanvasBoxRender",CanvasBoxState:""+window.MAIN_PATH+"../diagram/stateMachine/CanvasBoxState",CanvasBoxStateDiagram:""+window.MAIN_PATH+"../diagram/stateMachine/CanvasBoxStateDiagram",CanvasBoxStateLink:""+window.MAIN_PATH+"../diagram/stateMachine/CanvasBoxStateLink",CanvasBoxStateRender:""+window.MAIN_PATH+"../diagram/stateMachine/CanvasBoxStateRender"},New.prototype.arrClasses=Array(),New.prototype.loadClass=function(o){var a,n;Load[o]=function(){return!1},New[o]=new Function("return New.prototype.Ready({ name: '"+o+"', data: arguments });"),console.log("Load Class "+o);try{if(php.in_array(o,New.prototype.arrClasses))return!1;if(null==New.prototype.arrMap[o])throw new Error("Unabled to map the class "+o);if(console.log("loading... "+o),php.file_exists(New.prototype.arrMap[o]+".js"))console.log("load "+New.prototype.arrMap[o]+".js"),php.require_once(New.prototype.arrMap[o]+".js");else{n=php.file_get_contents(New.prototype.arrMap[o]+".coffee"),console.log("run "+o+".coffee");try{CoffeeScript.run(n)}catch(t){throw a=t,console.log("unable to run "+o),console.log(a.message),a}}return New.prototype.arrClasses.push(o),!0}catch(t){throw a=t,console.log("Error on load "+o),console.log(a),a}},New.prototype.construct=function(o,a){var n;return n=function(){return o.apply(this,arguments[0])},n.prototype=o.prototype,new n(a)},New.prototype.addMap=function(o,a){return null==a&&(a=null),console.log("New.addMap ",o,a),null!=a&&(New.prototype.arrMap[o]=a),New[o]=new Function("return New.prototype.Instance({ name: '"+o+"', data: arguments });"),Load[o]=new Function("return Load.prototype.Instance({ name: '"+o+"', data: arguments });")},New.prototype.importMap=function(o){var a,n,t,e,r,s,i;if(!php.file_exists(o))throw new Error("Unable to find the file "+o+".");r=php.file_get_contents(o);try{t=JSON.parse(r)}catch(p){throw a=p,n=new Error("Invalid Json receveid in file "+o),n.parentError=a,n}i=[];for(e in t)s=t[e],i.push(New.prototype.addMap(e,s));return i},New.prototype.start=function(){var o,a,n,t;n=New.prototype.arrMap,t=[];for(o in n)a=n[o],t.push(New.prototype.addMap(o));return t},New.prototype.Instance=function(o){return New.prototype.loadClass(o.name),New.prototype.construct(window[o.name],o.data)},New.prototype.Ready=function(o){return New.prototype.construct(window[o.name],o.data)},Load.prototype.Instance=function(o){return New.prototype.loadClass(o.name),window[o.name]},New.prototype.start();
var People;People=function(){function e(e){this.name=e,alert(""+this.name+" say hello world")}return e.prototype.name="anonymous",e.prototype.speak=function(){return alert("hi i am "+this.name)},e}();